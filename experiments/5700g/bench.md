# bench mark

- device: 5700G
- memory: 32GB DDR4 3200

## 1. baseline

- data of raw llama.cpp

### 1.1 cpu only

- open ocl compilation option and set ggml_cl_can_mul to false to force using cpu only
- default cpu threads: 8

|    PP |     TG |    B |   N_KV | S_PP t/s | S_TG t/s |    S t/s |
|-------|--------|------|--------|----------|----------|----------|
|   128 |     32 |    1 |    160 |   42.293 |    9.687 |   25.277 |
|   128 |     32 |    1 |    160 |   42.880 |    9.838 |   25.650 |
|   128 |     32 |    1 |    160 |   42.915 |    9.765 |   25.560 |
|   128 |     32 |    2 |    320 |   42.248 |   18.704 |   33.751 |
|   128 |     32 |    2 |    320 |   41.934 |   18.953 |   33.750 |
|   128 |     32 |    2 |    320 |   41.535 |   18.637 |   33.342 |
|   128 |     32 |    4 |    640 |   40.827 |   30.129 |   38.120 |
|   128 |     32 |    4 |    640 |   40.960 |   30.455 |   38.317 |
|   128 |     32 |    4 |    640 |   40.933 |   30.436 |   38.291 |
|   128 |     32 |    8 |   1280 |   38.690 |   34.595 |   37.796 |
|   128 |     32 |    8 |   1280 |   38.611 |   34.727 |   37.766 |
|   128 |     32 |    8 |   1280 |   38.696 |   34.481 |   37.772 |
|   128 |     32 |   16 |   2560 |   34.688 |   33.707 |   34.487 |
|   128 |     32 |   16 |   2560 |   34.903 |   33.549 |   34.623 |
|   128 |     32 |   16 |   2560 |   34.906 |   33.550 |   34.626 |
|   128 |     32 |   32 |   5120 |   28.165 |   28.287 |   28.189 |
|   128 |     32 |   32 |   5120 |   28.306 |   28.277 |   28.301 |
|   128 |     32 |   32 |   5120 |   28.292 |   28.337 |   28.301 |
|   128 |     32 |   64 |  10240 |   23.730 |   20.746 |   23.066 |
|   128 |     32 |   64 |  10240 |   23.765 |   20.360 |   22.996 |
|   128 |     32 |   64 |  10240 |   23.717 |   20.681 |   23.041 |
|   256 |     32 |    1 |    288 |   42.041 |    9.642 |   30.611 |
|   256 |     32 |    1 |    288 |   41.727 |    9.610 |   30.428 |
|   256 |     32 |    1 |    288 |   41.571 |    9.631 |   30.377 |
|   256 |     32 |    2 |    576 |   40.738 |   18.267 |   35.839 |
|   256 |     32 |    2 |    576 |   40.835 |   17.991 |   35.786 |
|   256 |     32 |    2 |    576 |   40.805 |   17.921 |   35.735 |
|   256 |     32 |    4 |   1152 |   38.758 |   28.780 |   37.320 |
|   256 |     32 |    4 |   1152 |   38.738 |   28.621 |   37.274 |
|   256 |     32 |    4 |   1152 |   38.684 |   28.182 |   37.146 |
|   256 |     32 |    8 |   2304 |   34.859 |   31.223 |   34.414 |
|   256 |     32 |    8 |   2304 |   34.823 |   31.149 |   34.373 |
|   256 |     32 |    8 |   2304 |   34.933 |   31.152 |   34.468 |
|   256 |     32 |   16 |   4608 |   28.289 |   28.291 |   28.289 |
|   256 |     32 |   16 |   4608 |   28.208 |   28.366 |   28.226 |
|   256 |     32 |   16 |   4608 |   28.220 |   28.422 |   28.242 |
|   256 |     32 |   32 |   9216 |   23.785 |   21.122 |   23.456 |
|   256 |     32 |   32 |   9216 |   23.834 |   21.179 |   23.507 |
|   256 |     32 |   32 |   9216 |   23.777 |   21.145 |   23.453 |
|   256 |     32 |   64 |  18432 |   17.635 |    9.862 |   16.215 |
|   256 |     32 |   64 |  18432 |   17.490 |    9.943 |   16.129 |
|   256 |     32 |   64 |  18432 |   17.516 |    9.943 |   16.150 |

* cpu
|    PP |     TG |    B |   N_KV | S_PP t/s | S_TG t/s |    S t/s |
|-------|--------|------|--------|----------|----------|----------|
|   256 |      5 |    1 |    261 |   40.191 |    9.437 |   37.830 |
|   256 |      5 |    1 |    261 |   40.141 |    9.457 |   37.792 |
|   256 |      5 |    1 |    261 |   40.372 |    9.317 |   37.949 |
|   512 |      5 |    1 |    517 |   38.489 |    8.983 |   37.304 |
|   512 |      5 |    1 |    517 |   39.117 |    9.190 |   37.923 |
|   512 |      5 |    1 |    517 |   39.075 |    9.198 |   37.885 |
|  1024 |      5 |    1 |   1029 |   36.889 |    8.516 |   36.301 |
|  1024 |      5 |    1 |   1029 |   37.041 |    8.438 |   36.441 |
|  1024 |      5 |    1 |   1029 |   37.039 |    8.576 |   36.451 |

### 1.2 cpu+igpu(force to use igpu)

* ngl = 0

| PP  | TG | B  | N_KV | S_PP t/s | S_TG t/s | S t/s  |
| --- | -- | -- | ---- | -------- | -------- | ------ |
| 128 | 32 | 1  | 160  | 20.556   | 0.793    | 3.433  |
| 128 | 32 | 1  | 160  | 20.581   | 0.791    | 3.428  |
| 128 | 32 | 1  | 160  | 20.619   | 0.791    | 3.430  |
| 128 | 32 | 2  | 320  | 27.527   | 0.393    | 1.860  |
| 128 | 32 | 2  | 320  | 27.492   | 0.393    | 1.858  |
| 128 | 32 | 2  | 320  | 27.437   | 0.393    | 1.859  |
| 128 | 32 | 4  | 640  | 29.839   | 0.775    | 3.512  |
| 128 | 32 | 4  | 640  | 29.859   | 0.775    | 3.511  |
| 128 | 32 | 4  | 640  | 29.877   | 0.775    | 3.510  |
| 128 | 32 | 8  | 1280 | 32.757   | 1.514    | 6.389  |
| 128 | 32 | 8  | 1280 | 32.895   | 1.517    | 6.405  |
| 128 | 32 | 8  | 1280 | 32.974   | 1.517    | 6.407  |
| 128 | 32 | 16 | 2560 | 32.230   | 2.646    | 9.959  |
| 128 | 32 | 16 | 2560 | 32.361   | 2.644    | 9.963  |
| 128 | 32 | 16 | 2560 | 32.419   | 2.642    | 9.962  |
| 128 | 32 | 24 | 3840 | 31.070   | 3.746    | 12.637 |
| 128 | 32 | 24 | 3840 | 31.308   | 3.744    | 12.664 |
| 128 | 32 | 24 | 3840 | 31.249   | 3.744    | 12.655 |
| 128 | 32 | 32 | 5120 | 28.370   | 4.613    | 13.975 |
| 128 | 32 | 32 | 5120 | 28.516   | 4.616    | 14.010 |
| 128 | 32 | 32 | 5120 | 28.322   | 4.610    | 13.960 |
| 256 | 32 | 1  | 288  | 27.613   | 0.769    | 5.660  |
| 256 | 32 | 1  | 288  | 27.667   | 0.767    | 5.651  |
| 256 | 32 | 1  | 288  | 27.607   | 0.768    | 5.653  |
| 256 | 32 | 2  | 576  | 29.694   | 0.387    | 3.153  |
| 256 | 32 | 2  | 576  | 30.093   | 0.387    | 3.155  |
| 256 | 32 | 2  | 576  | 30.344   | 0.387    | 3.162  |
| 256 | 32 | 4  | 1152 | 33.007   | 0.747    | 5.692  |
| 256 | 32 | 4  | 1152 | 33.158   | 0.745    | 5.681  |
| 256 | 32 | 4  | 1152 | 33.072   | 0.747    | 5.695  |
| 256 | 32 | 8  | 2304 | 31.943   | 1.373    | 9.194  |
| 256 | 32 | 8  | 2304 | 32.077   | 1.375    | 9.217  |
| 256 | 32 | 8  | 2304 | 32.181   | 1.375    | 9.225  |
| 256 | 32 | 16 | 4608 | 28.588   | 2.398    | 12.916 |
| 256 | 32 | 16 | 4608 | 28.722   | 2.393    | 12.924 |
| 256 | 32 | 16 | 4608 | 28.435   | 2.382    | 12.837 |
| 256 | 32 | 24 | 6912 | 26.455   | 3.082    | 14.356 |
| 256 | 32 | 24 | 6912 | 26.540   | 3.081    | 14.377 |
| 256 | 32 | 24 | 6912 | 26.519   | 3.081    | 14.371 |

* ngl = 999

|    PP |     TG |    B |   N_KV | S_PP t/s | S_TG t/s |    S t/s |
|-------|--------|------|--------|----------|----------|----------|
|   128 |     32 |    1 |    160 |   22.682 |    2.941 |    9.682 |
|   128 |     32 |    1 |    160 |   22.792 |    2.935 |    9.685 |
|   128 |     32 |    1 |    160 |   22.795 |    2.924 |    9.663 |
|   128 |     32 |    2 |    320 |   29.423 |    0.477 |    2.240 |
|   128 |     32 |    2 |    320 |   29.521 |    0.477 |    2.241 |

## 2. zero copy

- use zero copy for igpu opencl
- force to use igpu
- GGML_OPENCL_DEVICE=gfx90c:xnack- ./bin/combo_bench ~/Documents/igpu/llama-2-7b-chat.Q4_K_M.gguf 1,2,4,8,16,32,64 128,256 32

| PP  | TG | B  | N_KV | S_PP t/s | S_TG t/s | S t/s  |
| --- | -- | -- | ---- | -------- | -------- | ------ |
| 128 | 32 | 1  | 160  | 22.718   | 2.748    | 9.260  |
| 128 | 32 | 1  | 160  | 22.791   | 2.746    | 9.264  |
| 128 | 32 | 1  | 160  | 22.750   | 2.738    | 9.242  |
| 128 | 32 | 2  | 320  | 29.775   | 0.472    | 2.219  |
| 128 | 32 | 2  | 320  | 29.753   | 0.472    | 2.219  |
| 128 | 32 | 2  | 320  | 29.697   | 0.472    | 2.219  |
| 128 | 32 | 4  | 640  | 32.263   | 0.874    | 3.944  |
| 128 | 32 | 4  | 640  | 32.545   | 0.875    | 3.950  |
| 128 | 32 | 4  | 640  | 32.297   | 0.874    | 3.945  |
| 128 | 32 | 8  | 1280 | 35.408   | 1.641    | 6.923  |
| 128 | 32 | 8  | 1280 | 35.631   | 1.644    | 6.941  |
| 128 | 32 | 8  | 1280 | 35.703   | 1.639    | 6.923  |
| 128 | 32 | 16 | 2560 | 34.777   | 3.007    | 11.171 |
| 128 | 32 | 16 | 2560 | 35.286   | 3.008    | 11.217 |
| 128 | 32 | 16 | 2560 | 34.792   | 3.006    | 11.171 |
| 128 | 32 | 32 | 5120 | 31.308   | 5.473    | 16.104 |
| 128 | 32 | 32 | 5120 | 31.815   | 5.496    | 16.251 |
| 128 | 32 | 32 | 5120 | 31.560   | 5.489    | 16.185 |
| 256 | 32 | 1  | 288  | 29.889   | 2.403    | 13.161 |
| 256 | 32 | 1  | 288  | 29.909   | 2.407    | 13.178 |
| 256 | 32 | 1  | 288  | 29.847   | 2.409    | 13.175 |
| 256 | 32 | 2  | 576  | 32.530   | 0.463    | 3.739  |
| 256 | 32 | 2  | 576  | 32.408   | 0.463    | 3.737  |
| 256 | 32 | 2  | 576  | 32.361   | 0.463    | 3.738  |
| 256 | 32 | 4  | 1152 | 35.677   | 0.837    | 6.345  |
| 256 | 32 | 4  | 1152 | 35.640   | 0.838    | 6.345  |
| 256 | 32 | 4  | 1152 | 35.722   | 0.838    | 6.347  |
| 256 | 32 | 8  | 2304 | 35.437   | 1.533    | 10.248 |
| 256 | 32 | 8  | 2304 | 34.971   | 1.533    | 10.213 |
| 256 | 32 | 8  | 2304 | 35.321   | 1.533    | 10.241 |
| 256 | 32 | 16 | 4608 | 31.782   | 2.649    | 14.303 |
| 256 | 32 | 16 | 4608 | 31.532   | 2.648    | 14.256 |
| 256 | 32 | 16 | 4608 | 31.789   | 2.649    | 14.305 |
| 256 | 32 | 32 | 9216 | 28.022   | 4.510    | 17.743 |
| 256 | 32 | 32 | 9216 | 27.847   | 4.496    | 17.657 |
| 256 | 32 | 32 | 9216 | 27.825   | 4.502    | 17.660 |

- 新版
|    PP |     TG |    B |   N_KV | S_PP t/s | S_TG t/s |    S t/s |
|-------|--------|------|--------|----------|----------|----------|
|   128 |     32 |    1 |    160 |   22.888 |    3.707 |   11.247 |
|   128 |     32 |    1 |    160 |   22.969 |    3.707 |   11.263 |
|   128 |     32 |    1 |    160 |   23.003 |    3.699 |   11.256 |
|   128 |     32 |    2 |    320 |   29.753 |    0.476 |    2.236 |
|   128 |     32 |    2 |    320 |   29.760 |    0.477 |    2.241 |
|   128 |     32 |    2 |    320 |   29.911 |    0.477 |    2.241 |
|   128 |     32 |    4 |    640 |   32.090 |    0.892 |    4.014 |
|   128 |     32 |    4 |    640 |   32.433 |    0.892 |    4.016 |
|   128 |     32 |    4 |    640 |   32.325 |    0.892 |    4.016 |
|   128 |     32 |    8 |   1280 |   35.162 |    1.668 |    7.011 |
|   128 |     32 |    8 |   1280 |   35.368 |    1.668 |    7.017 |
|   128 |     32 |    8 |   1280 |   35.397 |    1.669 |    7.019 |
|   128 |     32 |   16 |   2560 |   34.353 |    3.026 |   11.188 |
|   128 |     32 |   16 |   2560 |   34.659 |    3.026 |   11.213 |
|   128 |     32 |   16 |   2560 |   34.753 |    3.026 |   11.221 |
|   128 |     32 |   32 |   5120 |   31.380 |    5.456 |   16.090 |
|   128 |     32 |   32 |   5120 |   31.437 |    5.446 |   16.084 |
|   128 |     32 |   32 |   5120 |   31.492 |    5.444 |   16.093 |
|   128 |     32 |   64 |  10240 |   27.732 |    8.719 |   19.310 |
|   128 |     32 |   64 |  10240 |   27.791 |    8.723 |   19.337 |
|   128 |     32 |   64 |  10240 |   27.817 |    8.732 |   19.356 |
|   256 |     32 |    1 |    288 |   29.930 |    3.399 |   16.028 |
|   256 |     32 |    1 |    288 |   29.919 |    3.397 |   16.021 |
|   256 |     32 |    1 |    288 |   29.972 |    3.412 |   16.072 |
|   256 |     32 |    2 |    576 |   32.464 |    0.463 |    3.743 |
|   256 |     32 |    2 |    576 |   32.314 |    0.463 |    3.741 |
|   256 |     32 |    2 |    576 |   32.189 |    0.463 |    3.740 |
|   256 |     32 |    4 |   1152 |   35.478 |    0.858 |    6.471 |
|   256 |     32 |    4 |   1152 |   35.306 |    0.858 |    6.463 |
|   256 |     32 |    4 |   1152 |   35.435 |    0.858 |    6.468 |
|   256 |     32 |    8 |   2304 |   34.840 |    1.547 |   10.274 |
|   256 |     32 |    8 |   2304 |   34.730 |    1.547 |   10.265 |
|   256 |     32 |    8 |   2304 |   34.677 |    1.547 |   10.261 |
|   256 |     32 |   16 |   4608 |   31.521 |    2.635 |   14.211 |
|   256 |     32 |   16 |   4608 |   31.362 |    2.637 |   14.188 |
|   256 |     32 |   16 |   4608 |   31.562 |    2.637 |   14.224 |
|   256 |     32 |   32 |   9216 |   27.692 |    4.349 |   17.346 |
|   256 |     32 |   32 |   9216 |   27.735 |    4.340 |   17.346 |
|   256 |     32 |   32 |   9216 |   27.755 |    4.351 |   17.373 |

- 对于edgenn中提到的，共享数据的竞争可能导致实际运算效率下降。进行相关实验，强制让dst使用单独的内存区域并拷贝到向量中
性能没有提升，batch较小时还有下降
| PP  | TG  | B   | N_KV | S_PP t/s | S_TG t/s | S t/s  |
| --- | --- | --- | ---- | -------- | -------- | ------ |
| 128 | 32  | 1   | 160  | 22.170   | 3.441    | 10.614 |
| 128 | 32  | 1   | 160  | 22.419   | 3.448    | 10.673 |
| 128 | 32  | 1   | 160  | 22.346   | 3.448    | 10.660 |
| 128 | 32  | 2   | 320  | 29.127   | 0.471    | 2.210  |
| 128 | 32  | 2   | 320  | 29.368   | 0.471    | 2.212  |
| 128 | 32  | 2   | 320  | 29.158   | 0.471    | 2.211  |
| 128 | 32  | 4   | 640  | 31.573   | 0.864    | 3.894  |
| 128 | 32  | 4   | 640  | 31.705   | 0.860    | 3.881  |
| 128 | 32  | 4   | 640  | 31.417   | 0.862    | 3.885  |
| 128 | 32  | 8   | 1280 | 34.342   | 1.632    | 6.856  |
| 128 | 32  | 8   | 1280 | 34.447   | 1.633    | 6.864  |
| 128 | 32  | 8   | 1280 | 34.463   | 1.633    | 6.863  |
| 128 | 32  | 16  | 2560 | 33.961   | 2.926    | 10.881 |
| 128 | 32  | 16  | 2560 | 34.041   | 2.925    | 10.885 |
| 128 | 32  | 16  | 2560 | 33.936   | 2.925    | 10.876 |
| 128 | 32  | 32  | 5120 | 30.664   | 5.423    | 15.881 |
| 128 | 32  | 32  | 5120 | 30.997   | 5.394    | 15.901 |
| 128 | 32  | 32  | 5120 | 30.661   | 5.415    | 15.867 |
| 256 | 32  | 1   | 288  | 29.068   | 3.226    | 15.380 |
| 256 | 32  | 1   | 288  | 29.286   | 3.220    | 15.419 |
| 256 | 32  | 1   | 288  | 29.308   | 3.221    | 15.427 |
| 256 | 32  | 2   | 576  | 31.526   | 0.457    | 3.683  |
| 256 | 32  | 2   | 576  | 31.576   | 0.457    | 3.683  |
| 256 | 32  | 2   | 576  | 31.910   | 0.457    | 3.688  |
| 256 | 32  | 4   | 1152 | 34.478   | 0.825    | 6.230  |
| 256 | 32  | 4   | 1152 | 34.482   | 0.825    | 6.234  |
| 256 | 32  | 4   | 1152 | 34.649   | 0.826    | 6.245  |
| 256 | 32  | 8   | 2304 | 34.086   | 1.527    | 10.116 |
| 256 | 32  | 8   | 2304 | 34.094   | 1.526    | 10.113 |
| 256 | 32  | 8   | 2304 | 33.877   | 1.526    | 10.096 |
| 256 | 32  | 16  | 4608 | 30.906   | 2.632    | 14.090 |
| 256 | 32  | 16  | 4608 | 30.979   | 2.632    | 14.103 |
| 256 | 32  | 16  | 4608 | 30.858   | 2.632    | 14.081 |
| 256 | 32  | 32  | 9216 | 27.226   | 4.473    | 17.395 |
| 256 | 32  | 32  | 9216 | 27.352   | 4.468    | 17.431 |
| 256 | 32  | 32  | 9216 | 27.319   | 4.472    | 17.427 |

## 3. combo
- GGML_OPENCL_DEVICE=gfx90c:xnack- nohup ./bin/combo_bench ~/Documents/igpu/llama-2-7b-chat.Q4_K_M.gguf 1,2,4,8,16,32 128,256 32 &

1. commit 54b4a7183c9c53a69299e412e94ff694f6306982

|    PP |     TG |    B |   N_KV | S_PP t/s | S_TG t/s |    S t/s |
|-------|--------|------|--------|----------|----------|----------|
|   128 |     32 |    1 |    160 |   39.290 |    7.129 |   20.655 |
|   128 |     32 |    1 |    160 |   42.682 |    7.159 |   21.422 |
|   128 |     32 |    1 |    160 |   40.801 |    7.182 |   21.073 |
|   128 |     32 |    2 |    320 |   49.415 |   12.716 |   31.330 |
|   128 |     32 |    2 |    320 |   48.603 |   12.682 |   31.027 |
|   128 |     32 |    2 |    320 |   48.459 |   12.684 |   30.983 |
|   128 |     32 |    4 |    640 |   51.284 |   17.632 |   37.116 |
|   128 |     32 |    4 |    640 |   50.817 |   17.713 |   36.990 |
|   128 |     32 |    4 |    640 |   50.168 |   17.775 |   36.767 |
|   128 |     32 |    8 |   1280 |   48.842 |    5.820 |   19.707 |
|   128 |     32 |    8 |   1280 |   50.146 |    5.814 |   19.860 |
|   128 |     32 |    8 |   1280 |   49.369 |    5.805 |   19.740 |
|   128 |     32 |   16 |   2560 |   43.827 |    9.371 |   25.255 |
|   128 |     32 |   16 |   2560 |   45.920 |    9.314 |   25.710 |
|   128 |     32 |   16 |   2560 |   45.670 |    9.304 |   25.633 |
|   128 |     32 |   32 |   5120 |   35.125 |   11.497 |   24.893 |
|   128 |     32 |   32 |   5120 |   36.043 |   11.625 |   25.381 |
|   128 |     32 |   32 |   5120 |   35.728 |   11.647 |   25.276 |
|   256 |     32 |    1 |    288 |   48.592 |    7.009 |   29.287 |
|   256 |     32 |    1 |    288 |   50.812 |    6.992 |   29.954 |
|   256 |     32 |    1 |    288 |   49.208 |    7.026 |   29.517 |
|   256 |     32 |    2 |    576 |   50.854 |   12.347 |   37.767 |
|   256 |     32 |    2 |    576 |   51.645 |   12.337 |   38.143 |
|   256 |     32 |    2 |    576 |   51.780 |   12.312 |   38.181 |
|   256 |     32 |    4 |   1152 |   49.751 |   16.817 |   40.860 |
|   256 |     32 |    4 |   1152 |   50.598 |   16.889 |   41.414 |
|   256 |     32 |    4 |   1152 |   51.140 |   16.821 |   41.690 |
|   256 |     32 |    8 |   2304 |   45.750 |    5.149 |   24.385 |
|   256 |     32 |    8 |   2304 |   45.659 |    5.157 |   24.381 |
|   256 |     32 |    8 |   2304 |   45.637 |    5.146 |   24.350 |
|   256 |     32 |   16 |   4608 |   35.874 |    7.572 |   25.348 |
|   256 |     32 |   16 |   4608 |   35.731 |    7.562 |   25.271 |
|   256 |     32 |   16 |   4608 |   35.634 |    7.543 |   25.205 |
|   256 |     32 |   32 |   9216 |   28.126 |    8.167 |   22.120 |
|   256 |     32 |   32 |   9216 |   28.326 |    8.217 |   22.270 |
|   256 |     32 |   32 |   9216 |   28.329 |    8.076 |   22.156 |

2. EdgeNN均衡算法

GGML_OPENCL_DEVICE=gfx90c:xnack- ./bin/combo_bench ~/Documents/igpu/llama-2-7b-chat.Q4_K_M.gguf 1 128,256,512 32 5

|    PP |     TG |    B |   N_KV | S_PP t/s | S_TG t/s |    S t/s |
|-------|--------|------|--------|----------|----------|----------|
|   128 |     32 |    1 |    160 |   23.069 |    4.883 |   13.221 |
|   128 |     32 |    1 |    160 |   33.759 |    4.774 |   15.247 |
|   128 |     32 |    1 |    160 |   38.408 |    4.845 |   16.101 |
|   128 |     32 |    1 |    160 |   34.722 |    4.836 |   15.528 |
|   128 |     32 |    1 |    160 |   37.897 |    4.833 |   16.003 |
|   256 |     32 |    1 |    288 |   42.982 |    4.102 |   20.934 |
|   256 |     32 |    1 |    288 |   44.842 |    4.105 |   21.326 |
|   256 |     32 |    1 |    288 |   45.095 |    4.218 |   21.712 |
|   256 |     32 |    1 |    288 |   45.039 |    4.203 |   21.657 |
|   256 |     32 |    1 |    288 |   45.264 |    4.216 |   21.741 |
|   512 |     32 |    1 |    544 |   45.386 |    3.821 |   27.675 |
|   512 |     32 |    1 |    544 |   47.472 |    3.873 |   28.562 |
|   512 |     32 |    1 |    544 |   47.900 |    3.982 |   29.052 |
|   512 |     32 |    1 |    544 |   47.891 |    3.843 |   28.603 |
|   512 |     32 |    1 |    544 |   47.572 |    3.887 |   28.639 |

3. 梯度下降算法

GGML_OPENCL_DEVICE=gfx90c:xnack- ./bin/combo_bench ~/Documents/igpu/llama-2-7b-chat.Q4_K_M.gguf 1 128,256,512 32 5

main: nthread = 8, n_kv_max = 4096, is_pp_shared = 0, n_gpu_layers = 0, mmq = 1

|    PP |     TG |    B |   N_KV | S_PP t/s | S_TG t/s |    S t/s |
|-------|--------|------|--------|----------|----------|----------|
|   128 |     64 |    1 |    192 |   37.137 |    6.002 |   13.608 |
|   128 |     64 |    1 |    192 |   39.401 |    6.394 |   14.482 |
|   128 |     64 |    1 |    192 |   38.939 |    6.394 |   14.440 |
|   128 |     64 |    1 |    192 |   41.446 |    6.167 |   14.258 |
|   128 |     64 |    1 |    192 |   39.525 |    6.408 |   14.518 |
|   256 |     64 |    1 |    320 |   53.014 |    5.922 |   20.465 |
|   256 |     64 |    1 |    320 |   56.163 |    6.279 |   21.694 |
|   256 |     64 |    1 |    320 |   55.596 |    6.270 |   21.603 |
|   256 |     64 |    1 |    320 |   57.011 |    6.286 |   21.810 |
|   256 |     64 |    1 |    320 |   58.381 |    6.287 |   21.971 |
|   384 |     64 |    1 |    448 |   50.967 |    5.675 |   23.814 |
|   384 |     64 |    1 |    448 |   57.483 |    6.194 |   26.333 |
|   384 |     64 |    1 |    448 |   57.021 |    6.208 |   26.284 |
|   384 |     64 |    1 |    448 |   58.216 |    6.242 |   26.590 |
|   384 |     64 |    1 |    448 |   59.180 |    6.224 |   26.713 |
|   512 |     64 |    1 |    576 |   49.640 |    5.524 |   26.302 |
|   512 |     64 |    1 |    576 |   52.976 |    6.142 |   28.679 |
|   512 |     64 |    1 |    576 |   53.513 |    6.135 |   28.801 |
|   512 |     64 |    1 |    576 |   52.846 |    6.120 |   28.591 |
|   512 |     64 |    1 |    576 |   53.406 |    6.169 |   28.855 |
|  1024 |     64 |    1 |   1088 |   52.550 |    5.112 |   33.994 |
|  1024 |     64 |    1 |   1088 |   57.129 |    5.833 |   37.651 |
|  1024 |     64 |    1 |   1088 |   57.411 |    5.838 |   37.778 |
|  1024 |     64 |    1 |   1088 |   56.159 |    5.849 |   37.291 |
|  1024 |     64 |    1 |   1088 |   54.998 |    5.798 |   36.686 |
|  2048 |     64 |    1 |   2112 |   49.634 |    3.448 |   35.305 |
|  2048 |     64 |    1 |   2112 |   51.307 |    5.304 |   40.628 |
|  2048 |     64 |    1 |   2112 |   52.920 |    5.282 |   41.562 |
|  2048 |     64 |    1 |   2112 |   52.228 |    5.280 |   41.143 |
|  2048 |     64 |    1 |   2112 |   52.818 |    5.316 |   41.564 |
|  3072 |     64 |    1 |   3136 |   44.889 |    3.227 |   35.528 |
|  3072 |     64 |    1 |   3136 |   46.958 |    4.970 |   40.052 |
|  3072 |     64 |    1 |   3136 |   48.274 |    4.925 |   40.922 |
|  3072 |     64 |    1 |   3136 |   48.054 |    4.920 |   40.760 |
|  3072 |     64 |    1 |   3136 |   47.727 |    4.972 |   40.602 |
|  4096 |     64 |    1 |   4160 | kv not enough | | |
